<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ServiTech: Service Status</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <header class="navbar">
    <a href="landing.html" class="logo">
      <img src="./IMAGES/LOGO_SERVITECH.png" alt="ServiTech Logo" class="servitech-logo">
      <h1>ServiTech</h1>
    </a>
    <nav>
      <a href="customer_dash.html">Customer Home</a>
      <a href="landing.html">Logout</a>
    </nav>
  </header>

  <main class="form-page" style="min-height:60vh;">
    <div style="max-width:1000px;margin:24px auto;">
      <div style="background:#ff9f2e;padding:14px 18px;border-radius:6px 6px 0 0;color:#fff;margin-bottom:18px;display:flex;align-items:center;gap:12px;">
        <a href="customer_dash.html" style="color:#fff;text-decoration:none;font-size:18px;">←</a>
        <strong>Service Status</strong>
      </div>

      <h3 style="color:#b03a00;border-bottom:2px solid #e8b27a;padding-bottom:8px;">ACTIVE QUEUE</h3>

      <!-- queue lists will be rendered here from localStorage -->
      <div id="activeQueueList" class="queue-list"></div>

      <h3 style="color:#b03a00;border-bottom:2px solid #e8b27a;padding-bottom:8px;margin-top:28px;">ONLINE PRINT ORDER</h3>

      <div id="onlinePrintList" class="queue-list"></div>

      <!-- Detail modal (hidden) -->
      <div id="detailModal" class="modal-overlay" style="display:none;position:fixed;inset:0;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);z-index:9999;">
        <div class="modal" role="dialog" aria-modal="true" style="background:#fff;border-radius:12px;padding:22px;max-width:420px;width:92%;box-shadow:0 12px 30px rgba(0,0,0,0.25);text-align:left;">
          <button id="closeDetail" style="position:absolute;right:14px;top:12px;background:none;border:none;font-size:20px;cursor:pointer;color:#6b0b0b">✕</button>
          <h3 style="margin:6px 0 8px;font-size:20px;color:#222;text-align:center">Walk-in Queue: <span id="modalType">Print</span></h3>
          <div style="height:8px"></div>
          <div style="border-bottom:2px solid #f3c27a;margin-bottom:12px"></div>
          <div style="font-size:14px;color:#333;line-height:1.5">
            <div><strong>Queue ID:</strong> <span id="modalQueue"></span></div>
            <div><strong>Customer:</strong> <span id="modalCustomer">Trisha Mae Agbayani</span></div>
            <div><strong>Service:</strong> <span id="modalService"></span></div>
            <div id="modalExtra"></div>
            <div style="margin-top:8px"><strong>Attached File:</strong> <a id="modalFile" href="#" target="_blank"></a></div>
            <div style="margin-top:10px"><strong>Additional Instructions/Edit Request:</strong></div>
            <textarea id="modalNotes" style="width:100%;height:60px;margin-top:6px;padding:8px;border:1px solid #ddd;border-radius:6px;" readonly></textarea>
          </div>
          <div style="display:flex;gap:10px;justify-content:center;margin-top:12px">
            <button id="modalViewQueue" style="background:#24120f;color:#fff;border:none;padding:10px 18px;border-radius:8px;cursor:pointer">View Queue Status</button>
            <button id="modalCloseBtn" style="background:#fff;color:#111;border:1px solid #ddd;padding:10px 18px;border-radius:8px;cursor:pointer">Close</button>
          </div>
        </div>
      </div>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-container">
      <div class="footer-left">
        <h3>Contact Us:</h3>
        <div class="contact-item">
          <img src="./IMAGES/FOOTER_FB.png" alt="Facebook">
          <a href="https://www.facebook.com/" target="_blank">JC Repair Shop</a>
        </div>
        <div class="contact-item">
          <img src="./IMAGES/FOOTER_EMAIL.png" alt="Email">
          <a href="mailto:servitech@gmail.com">servitech@gmail.com</a>
        </div>
        <div class="contact-item">
          <img src="./IMAGES/FOOTER_PHONE.png" alt="Phone">
          <span>+63 912 393 4321</span>
        </div>
      </div>
      <div class="footer-right">
        <a href="landing.html" class="footer-logo-link">
          <img src="./IMAGES/LOGO_SERVITECH.png" alt="ServiTech Logo" class="footer-servitech-logo">
          <h1>ServiTech: JC Repair Shop</h1>
        </a>
      </div>
    </div>
    <p class="footer-bottom">© 2026 ServiTech: JC Repair Shop</p>
  </footer>

  <script src="main.js"></script>
  <script>
    (function(){
      const detailModal = document.getElementById('detailModal');
      const closeDetail = document.getElementById('closeDetail');
      const modalCloseBtn = document.getElementById('modalCloseBtn');
      const modalViewQueue = document.getElementById('modalViewQueue');

      function buildCard(entry){
        const div = document.createElement('div');
        div.className = 'card queue-card';
        div.tabIndex = 0;
        div.setAttribute('role','button');
        div.dataset.queue = entry.id || '';
        div.dataset.type = entry.category || '';
        div.dataset.service = entry.service || '';
        div.dataset.notes = (entry.meta && entry.meta.notes) || '';
        // extra meta copy if present
        if(entry.meta){
          if(entry.meta.device) div.dataset.device = entry.meta.device;
          if(entry.meta.size) div.dataset.size = entry.meta.size;
          if(entry.meta.color) div.dataset.color = entry.meta.color;
          if(entry.meta.copies) div.dataset.copies = entry.meta.copies;
          if(entry.meta.file) div.dataset.file = entry.meta.file;
        }

        div.style.borderRadius = '18px';
        div.style.padding = '20px';
        div.style.margin = '18px 0';
        div.style.cursor = 'pointer';

        const head = document.createElement('div');
        head.style.display = 'flex'; head.style.alignItems = 'center'; head.style.justifyContent = 'space-between';
        const idEl = document.createElement('div'); idEl.style.fontWeight='700'; idEl.style.fontSize='20px'; idEl.textContent = entry.id || '';
        const statusEl = document.createElement('div'); statusEl.style.background='#f59e0b'; statusEl.style.color='#fff'; statusEl.style.padding='6px 10px'; statusEl.style.borderRadius='14px'; statusEl.style.fontWeight='700'; statusEl.style.fontSize='12px'; statusEl.textContent = entry.status || '';
        head.appendChild(idEl); head.appendChild(statusEl);

        const hr = document.createElement('hr'); hr.style.border='none'; hr.style.height='2px'; hr.style.background='#f3c27a'; hr.style.margin='12px 0'; hr.style.borderRadius='2px';

        const body = document.createElement('p'); body.style.margin='6px 0'; body.style.lineHeight='1.3'; body.style.color='#333'; body.style.fontSize='14px';
        // build description lines
        const lines = [];
        if(entry.category === 'xerox' || entry.category === 'print' || (entry.service && /print/i.test(entry.service))) {
          lines.push(entry.service || 'Document Printing');
          if(entry.meta && entry.meta.size) lines.push(entry.meta.size);
          if(entry.meta && entry.meta.color) lines.push(entry.meta.color);
          if(entry.meta && entry.meta.copies) lines.push('Copies: ' + entry.meta.copies);
          if(entry.meta && entry.meta.file) lines.push('Attached file: ' + entry.meta.file);
        } else if (entry.category === 'repair' || /repair/i.test(entry.service)){
          lines.push('Repair');
          if(entry.meta && entry.meta.device) lines.push(entry.meta.device);
          if(entry.service) lines.push(entry.service);
          if(entry.meta && entry.meta.notes) lines.push('Additional Comment: ' + entry.meta.notes);
        } else if (entry.category === 'installation' || /install/i.test(entry.service)){
          lines.push('Installation/Software');
          if(entry.service) lines.push(entry.service);
          if(entry.meta && entry.meta.notes) lines.push('Additional Comment: ' + entry.meta.notes);
        } else {
          if(entry.service) lines.push(entry.service);
          if(entry.meta && entry.meta.notes) lines.push('Notes: ' + entry.meta.notes);
        }

        body.innerHTML = lines.join('<br>');

        div.appendChild(head); div.appendChild(hr); div.appendChild(body);
        return div;
      }

      function renderQueues(){
        const active = document.getElementById('activeQueueList');
        const online = document.getElementById('onlinePrintList');
        active.innerHTML = ''; online.innerHTML = '';
        const key = 'servitech_queues';
        const list = JSON.parse(localStorage.getItem(key) || '[]');
        if(!list || !list.length) {
          active.innerHTML = '<p class="muted">No active queues yet.</p>';
          online.innerHTML = '<p class="muted">No online print orders yet.</p>';
          return;
        }

        list.forEach(entry => {
          const card = buildCard(entry);
          // decide where to put it
          const cat = (entry.category || '').toLowerCase();
          if(cat === 'xerox' || cat === 'print' || /print/i.test(entry.service) || entry.category === 'general'){
            // online print orders go to online if status indicates 'FOR PICK-UP' else active
            if(entry.status && /pick/i.test(entry.status)) online.appendChild(card);
            else active.appendChild(card);
          } else if (cat === 'installation' || cat === 'repair'){
            active.appendChild(card);
          } else {
            active.appendChild(card);
          }
        });

        // attach handlers (event delegation could be used instead)
        document.querySelectorAll('.queue-card').forEach(card => {
          card.addEventListener('click', () => openDetail(card));
          card.addEventListener('keydown', (e) => { if(e.key === 'Enter' || e.key === ' ') openDetail(card); });
        });
      }

      function openDetail(card){
        if(!card) return;
        const q = card.dataset.queue || '';
        const type = card.dataset.type || '';
        const service = card.dataset.service || '';
        const device = card.dataset.device || '';
        const size = card.dataset.size || '';
        const color = card.dataset.color || '';
        const copies = card.dataset.copies || '';
        const file = card.dataset.file || '';
        const notes = card.dataset.notes || '';

        document.getElementById('modalQueue').textContent = q;
        document.getElementById('modalType').textContent = type || '';
        document.getElementById('modalService').textContent = service || (device || size || '');
        const extra = document.getElementById('modalExtra');
        extra.innerHTML = '';
        if (device) extra.innerHTML += '<div><strong>Device:</strong> ' + device + '</div>';
        if (size) extra.innerHTML += '<div><strong>Paper Size:</strong> ' + size + '</div>';
        if (color) extra.innerHTML += '<div><strong>Color Option:</strong> ' + color + '</div>';
        if (copies) extra.innerHTML += '<div><strong>Copies:</strong> ' + copies + '</div>';

        const modalFile = document.getElementById('modalFile');
        if (file) { modalFile.textContent = file; modalFile.href = file; } else { modalFile.textContent = ''; modalFile.removeAttribute('href'); }
        document.getElementById('modalNotes').value = notes || '';

        detailModal.style.display = 'flex';
      }

      // close handlers
      [closeDetail, modalCloseBtn].forEach(btn => { if(btn) btn.addEventListener('click', () => detailModal.style.display = 'none'); });
      if (modalViewQueue) modalViewQueue.addEventListener('click', () => { detailModal.style.display = 'none'; });
      if (detailModal) detailModal.addEventListener('click', (e) => { if (e.target === detailModal) detailModal.style.display = 'none'; });

      // initial render
      renderQueues();

      // allow other pages to trigger re-render if they add new entries
      window.renderServiTechQueues = renderQueues;
    })();
  </script>
</body>
</html>
